<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cadastro de Produto</title>
    <style>
      #nav-top { display: flex; flex-direction: column; padding: 0; }
      #div-top { padding: 0.5rem 1rem 0 1rem; background-color:#f8f9fa; }
      #top-bar { display: flex; align-items: center; justify-content: space-between; width: 100%; margin: 0; }
      .div-tab { display: flex; justify-content: center; align-items: center; }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    
    <nav class="navbar bg-body-tertiary" id="nav-top">
      <div class="container-fluid" id="div-top">
        <a class="navbar-brand" href="#" id="top-bar">
          <img src="models/logo-NEXO-NoBG.svg" id="home1" alt="Logo" width="40" height="40" class="d-inline-block align-text-top">
          <span class="navbar-brand mb-0 h1" style="font-size: 2rem; font-weight: 600;" id="home2">NEXO</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-box2-fill" viewBox="0 0 16 16">
            <path d="M3.75 0a1 1 0 0 0-.8.4L.1 4.2a.5.5 0 0 0-.1.3V15a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1V4.5a.5.5 0 0 0-.1-.3L13.05.4a1 1 0 0 0-.8-.4zM15 4.667V5H1v-.333L1.5 4h6V1h1v3h6z"/>
          </svg>
        </a>
      </div>
      <div id="div-tab" class="div-tab">
        <ul class="nav justify-content-center">
          <li class="nav-item">
            <span id="home3" style="cursor: pointer;">
              <a class="nav-link disabled" aria-disabled="true">HOME</a>
            </span>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container mt-4" style="max-width: 50rem; background-color: rgba(0, 0, 0, 0.09); border-radius: 10px; padding: 20px 50px;">
        <h3 class="mb-4">Novo Produto</h3>
        
        <div id="alertaSistema" class="alert d-none" role="alert"></div>

        <form id="formCadastro">
            <div class="mb-3">
                <label for="ProdID" class="form-label">ID do produto (Automático)</label>
                <input type="hidden" class="form-control" id="ProdID" placeholder="Gerado pelo sistema">
            </div>
            <div class="mb-3">
                <label for="ProdNome" class="form-label">Nome</label>
                <input type="text" class="form-control" id="ProdNome" required>
            </div>
            <div class="mb-3">
                <label for="ProdCusto" class="form-label">Valor de Custo</label>
                <input type="number" class="form-control" id="ProdCusto" step="0.01" required>
            </div>
            <div class="mb-3">
                <label for="ProdVenda" class="form-label">Valor de Venda</label>
                <input type="number" class="form-control" id="ProdVenda" step="0.01" required>
            </div>
            <div class="mb-3">
                <label for="ProdQuant" class="form-label">Quantidade</label>
                <input type="number" class="form-control" id="ProdQuant" required>
            </div>
            <button type="submit" class="btn btn-primary" id="btnCadastrar">Cadastrar</button>
        </form>
    </div>

    <script>
      
        const irHome = () => location.href = "home.html";
        document.getElementById("home1").onclick = irHome;
        document.getElementById("home2").onclick = irHome;
        document.getElementById("home3").onclick = irHome;

        // --- LÓGICA DO CADASTRO ---
        const formCadastro = document.getElementById('formCadastro');
        const btnCadastrar = document.getElementById('btnCadastrar');
        const alerta = document.getElementById('alertaSistema');

        // IMPORTANTE: Se o arquivo estiver na pasta Data, mantenha 'Data/insereProduto.php'
        const URL_PHP = 'Data/insereProduto.php'; 

        formCadastro.addEventListener('submit', function(e) {
            e.preventDefault(); // Não recarrega a página

            // Feedback visual de carregamento
            btnCadastrar.disabled = true;
            btnCadastrar.innerText = "Salvando...";
            alerta.classList.add('d-none'); // Esconde alerta antigo

            // 1. Pega os dados dos inputs
            const nome = document.getElementById('ProdNome').value;
            const custo = document.getElementById('ProdCusto').value;
            const venda = document.getElementById('ProdVenda').value;
            const quant = document.getElementById('ProdQuant').value;

            // 2. Cria o envelope (FormData)
            // As chaves ('Nome', 'Valor_Custo') devem ser IGUAIS ao que está no seu PHP ($_POST)
            let dados = new FormData();
            dados.append('Nome', nome);
            dados.append('Valor_Custo', custo);
            dados.append('Valor_Venda', venda);
            dados.append('Quantidade', quant);

            // 3. Envia para o PHP
            fetch(URL_PHP, {
                method: 'POST',
                body: dados
            })
            .then(res => res.json())
            .then(resposta => {
                btnCadastrar.disabled = false;
                btnCadastrar.innerText = "Cadastrar";

                if (resposta.mensagem) {
                    // SUCESSO
                    alerta.className = 'alert alert-success';
                    alerta.innerText = resposta.mensagem;
                    alerta.classList.remove('d-none');
                    formCadastro.reset(); // Limpa os campos
                } else {
                    // ERRO (Do PHP ou Validação)
                    alerta.className = 'alert alert-danger';
                    alerta.innerText = resposta.erro || resposta.Erro || "Erro desconhecido.";
                    alerta.classList.remove('d-none');
                }
            })
            .catch(erro => {
                console.error(erro);
                btnCadastrar.disabled = false;
                btnCadastrar.innerText = "Cadastrar";
                alerta.className = 'alert alert-danger';
                alerta.innerText = "Erro de conexão com o servidor.";
                alerta.classList.remove('d-none');
            });
        });

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>